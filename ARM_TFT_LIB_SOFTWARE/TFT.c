
#include "TFT.h"



uint8_t FONT[133][8]  =
{
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},//, // space 0x20
    {0x30,0x78,0x78,0x30,0x30,0x00,0x30,0x00}, // !
    {0x6C,0x6C,0x6C,0x00,0x00,0x00,0x00,0x00}, // "
    {0x6C,0x6C,0xFE,0x6C,0xFE,0x6C,0x6C,0x00}, // #
    {0x18,0x3E,0x60,0x3C,0x06,0x7C,0x18,0x00}, // $
    {0x00,0x63,0x66,0x0C,0x18,0x33,0x63,0x00}, // %
    {0x1C,0x36,0x1C,0x3B,0x6E,0x66,0x3B,0x00}, // &
    {0x30,0x30,0x60,0x00,0x00,0x00,0x00,0x00}, // '
    {0x0C,0x18,0x30,0x30,0x30,0x18,0x0C,0x00}, // (
    {0x30,0x18,0x0C,0x0C,0x0C,0x18,0x30,0x00}, // )
    {0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00}, // *
    {0x00,0x30,0x30,0xFC,0x30,0x30,0x00,0x00}, // +
    {0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x30}, // ,
    {0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00}, // -
    {0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00}, // .
    {0x03,0x06,0x0C,0x18,0x30,0x60,0x40,0x00}, // ' (forward slash)
    {0x3E,0x63,0x63,0x6B,0x63,0x63,0x3E,0x00}, // 0 0x30
    {0x18,0x38,0x58,0x18,0x18,0x18,0x7E,0x00}, // 1
    {0x3C,0x66,0x06,0x1C,0x30,0x66,0x7E,0x00}, // 2
    {0x3C,0x66,0x06,0x1C,0x06,0x66,0x3C,0x00}, // 3
    {0x0E,0x1E,0x36,0x66,0x7F,0x06,0x0F,0x00}, // 4
    {0x7E,0x60,0x7C,0x06,0x06,0x66,0x3C,0x00}, // 5
    {0x1C,0x30,0x60,0x7C,0x66,0x66,0x3C,0x00}, // 6
    {0x7E,0x66,0x06,0x0C,0x18,0x18,0x18,0x00}, // 7
    {0x3C,0x66,0x66,0x3C,0x66,0x66,0x3C,0x00}, // 8
    {0x3C,0x66,0x66,0x3E,0x06,0x0C,0x38,0x00}, // 9
    {0x00,0x18,0x18,0x00,0x00,0x18,0x18,0x00}, // :
    {0x00,0x18,0x18,0x00,0x00,0x18,0x18,0x30}, // ;
    {0x0C,0x18,0x30,0x60,0x30,0x18,0x0C,0x00}, // <
    {0x00,0x00,0x7E,0x00,0x00,0x7E,0x00,0x00}, // =
    {0x30,0x18,0x0C,0x06,0x0C,0x18,0x30,0x00}, // >
    {0x3C,0x66,0x06,0x0C,0x18,0x00,0x18,0x00}, // ?
    {0x3E,0x63,0x6F,0x69,0x6F,0x60,0x3E,0x00}, // @ 0x40
    {0x18,0x3C,0x66,0x66,0x7E,0x66,0x66,0x00}, // A
    {0x7E,0x33,0x33,0x3E,0x33,0x33,0x7E,0x00}, // B
    {0x1E,0x33,0x60,0x60,0x60,0x33,0x1E,0x00}, // C
    {0x7C,0x36,0x33,0x33,0x33,0x36,0x7C,0x00}, // D
    {0x7F,0x31,0x34,0x3C,0x34,0x31,0x7F,0x00}, // E
    {0x7F,0x31,0x34,0x3C,0x34,0x30,0x78,0x00}, // F
    {0x1E,0x33,0x60,0x60,0x67,0x33,0x1F,0x00}, // G
    {0x66,0x66,0x66,0x7E,0x66,0x66,0x66,0x00}, // H
    {0x3C,0x18,0x18,0x18,0x18,0x18,0x3C,0x00}, // I
    {0x0F,0x06,0x06,0x06,0x66,0x66,0x3C,0x00}, // J
    {0x73,0x33,0x36,0x3C,0x36,0x33,0x73,0x00}, // K
    {0x78,0x30,0x30,0x30,0x31,0x33,0x7F,0x00}, // L
    {0x63,0x77,0x7F,0x7F,0x6B,0x63,0x63,0x00}, // M
    {0x63,0x73,0x7B,0x6F,0x67,0x63,0x63,0x00}, // N
    {0x3E,0x63,0x63,0x63,0x63,0x63,0x3E,0x00}, // O
    {0x7E,0x33,0x33,0x3E,0x30,0x30,0x78,0x00}, // P 0x50
    {0x3C,0x66,0x66,0x66,0x6E,0x3C,0x0E,0x00}, // Q
    {0x7E,0x33,0x33,0x3E,0x36,0x33,0x73,0x00}, // R
    {0x3C,0x66,0x30,0x18,0x0C,0x66,0x3C,0x00}, // S
    {0x7E,0x5A,0x18,0x18,0x18,0x18,0x3C,0x00}, // T
    {0x66,0x66,0x66,0x66,0x66,0x66,0x7E,0x00}, // U
    {0x66,0x66,0x66,0x66,0x66,0x3C,0x18,0x00}, // V
    {0x63,0x63,0x63,0x6B,0x7F,0x77,0x63,0x00}, // W
    {0x63,0x63,0x36,0x1C,0x1C,0x36,0x63,0x00}, // X
    {0x66,0x66,0x66,0x3C,0x18,0x18,0x3C,0x00}, // Y
    {0x7F,0x63,0x46,0x0C,0x19,0x33,0x7F,0x00}, // Z
    {0x3C,0x30,0x30,0x30,0x30,0x30,0x3C,0x00}, // [
    {0x60,0x30,0x18,0x0C,0x06,0x03,0x01,0x00}, // \ (back slash)
    {0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x3C,0x00}, // ]
    {0x08,0x1C,0x36,0x63,0x00,0x00,0x00,0x00}, // ^
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF}, // _
    {0x18,0x18,0x0C,0x00,0x00,0x00,0x00,0x00}, // ` 0x60
    {0x00,0x00,0x3C,0x06,0x3E,0x66,0x3B,0x00}, // a
    {0x70,0x30,0x3E,0x33,0x33,0x33,0x6E,0x00}, // b
    {0x00,0x00,0x3C,0x66,0x60,0x66,0x3C,0x00}, // c
    {0x0E,0x06,0x3E,0x66,0x66,0x66,0x3B,0x00}, // d
    {0x00,0x00,0x3C,0x66,0x7E,0x60,0x3C,0x00}, // e
    {0x1C,0x36,0x30,0x78,0x30,0x30,0x78,0x00}, // f
    {0x00,0x00,0x3B,0x66,0x66,0x3E,0x06,0x7C}, // g
    {0x70,0x30,0x36,0x3B,0x33,0x33,0x73,0x00}, // h
    {0x18,0x00,0x38,0x18,0x18,0x18,0x3C,0x00}, // i
    {0x06,0x00,0x06,0x06,0x06,0x66,0x66,0x3C}, // j
    {0x70,0x30,0x33,0x36,0x3C,0x36,0x73,0x00}, // k
    {0x38,0x18,0x18,0x18,0x18,0x18,0x3C,0x00}, // l
    {0x00,0x00,0x66,0x7F,0x7F,0x6B,0x63,0x00}, // m
    {0x00,0x00,0x7C,0x66,0x66,0x66,0x66,0x00}, // n
    {0x00,0x00,0x3C,0x66,0x66,0x66,0x3C,0x00}, // o
    {0x00,0x00,0x6E,0x33,0x33,0x3E,0x30,0x78}, // p 0x70
    {0x00,0x00,0x3B,0x66,0x66,0x3E,0x06,0x0F}, // q
    {0x00,0x00,0x6E,0x3B,0x33,0x30,0x78,0x00}, // r
    {0x00,0x00,0x3E,0x60,0x3C,0x06,0x7C,0x00}, // s
    {0x08,0x18,0x3E,0x18,0x18,0x1A,0x0C,0x00}, // t
    {0x00,0x00,0x66,0x66,0x66,0x66,0x3B,0x00}, // u
    {0x00,0x00,0x66,0x66,0x66,0x3C,0x18,0x00}, // v
    {0x00,0x00,0x63,0x6B,0x7F,0x7F,0x36,0x00}, // w
    {0x00,0x00,0x63,0x36,0x1C,0x36,0x63,0x00}, // x
    {0x00,0x00,0x66,0x66,0x66,0x3E,0x06,0x7C}, // y
    {0x00,0x00,0x7E,0x4C,0x18,0x32,0x7E,0x00}, // z
    {0x0E,0x18,0x18,0x70,0x18,0x18,0x0E,0x00}, // {
    {0x0C,0x0C,0x0C,0x00,0x0C,0x0C,0x0C,0x00}, // |
    {0x70,0x18,0x18,0x0E,0x18,0x18,0x70,0x00}, // }
    {0x3B,0x6E,0x00,0x00,0x00,0x00,0x00,0x00}, // ~
    {0x1C,0x36,0x36,0x1C,0x00,0x00,0x00,0x00}, // DEL
    {0x60,0x90,0x90,0x60,0x00,0x00,0x00,0x00}, // DEGREE use
    {0x22,0x77,0x7f,0x7f,0x3e,0x1c,0x08,0x00},//HEART use
    {0x54,0xAA,0x81,0xA5,0x81,0x5A,0x24,0x18},
    {0x54,0xAA,0x81,0xA5,0xA5,0x5A,0x24,0x18},
    {0xFF,0x81,0x81,0x81,0x81,0x81,0x81,0xFF}
};



int strlen(const char *str)
{
    const char *s;

    for (s = str; *s; ++s)
        ;
    return (s - str);
}

uint8_t RGB565TORGB323(uint16_t COLOR)
{


    uint8_t B =  (((COLOR) & 0x001F) << 3);
    uint8_t G  = (((COLOR) & 0x07E0) >> 3);
    uint8_t R  = (((COLOR) & 0xF800) >> 8);



    uint8_t k = 0;
    k =  (((R)&0xE0) | ((G>>3)&0x18) | ((B>>5)&0x7));



    return k;
}

uint16_t RGB565(uint8_t R, uint8_t G, uint8_t B)
{
    return (((R>>3)<<11) | ((G>>2)<<5) | (B>>3));
}

uint8_t RGB323(uint8_t R, uint8_t G, uint8_t B)
{
    uint8_t k = 0;
    k =  (((R)&0xE0) | ((G>>3)&0x18) | ((B>>5)&0x7));

    return  k;
}

void TFT_bitmap(void *h2p_lw_addr, uint16_t *img, uint16_t x, uint16_t y)
{
    int i=0;
    for(i=0; i<x*y; i++)
    {
        *(uint8_t *)(h2p_lw_addr+i) = RGB565TORGB323(img[i]);
    }

}

void TFT_text(void *h2p_lw_addr, char* text, uint16_t x, uint16_t y, uint16_t COLOR)
{
    unsigned char length = strlen(text);
    while(length--)
    {
        TFT_char(h2p_lw_addr,*(text++),x,y,COLOR);

        x += 8;
    }
}

void TFT_char(void *h2p_lw_addr,char sign,uint16_t x, uint16_t y, uint16_t COLOR)
{

    uint8_t c = (uint8_t)sign-0x20;
    uint8_t mask=0b10000000;
    uint8_t line;

    uint8_t i;
    uint8_t j;


    for(i=0; i<8; i++)
    {
        line = FONT[c][i];
        mask=0b10000000;

        for(j=0; j<8; j++)
        {
            if(line&mask)
            {
                TFT_setpix(h2p_lw_addr,x+j,y+i,COLOR);
            }
            mask>>=1;
        }

    }

}

void TFT_fill(void *h2p_lw_addr,uint8_t COLOR)
{

    int x=0;
    int y=0;

    for ( x=0; x<Hsize; x++)
    {
        for ( y=0; y<Vsize; y++)
        {
            TFT_setpix(h2p_lw_addr,x,y,COLOR);
        }
    }
}

void TFT_rectangle(void *h2p_lw_addr,uint16_t x1, uint16_t y1, uint16_t x2, uint16_t y2, uint8_t COLOR)
{
    int x=0;
    int y=0;

    for(y = y1; y <= y2; y++)
    {
        for(x = x1; x <= x2; x++)
        {
            TFT_setpix(h2p_lw_addr,x,y,COLOR);
        }
    }
}


void TFT_circle(void *h2p_lw_addr,uint16_t x, uint16_t y, uint16_t rad, uint8_t COLOR)
{
    int x1=0;
    int y1=0;

    for( y1=0; y1<=2*rad; y1++)
    {
        for( x1=0; x1<=2*rad; x1++)
        {
            if (((x1-rad)*(x1-rad)+(y1-rad)*(y1-rad) <= (rad*rad))&&((x1-rad)*(x1-rad)+(y1-rad)*(y1-rad) >= (rad*rad)-3*rad))
            {
                TFT_setpix(h2p_lw_addr,x1+x,y1+y,COLOR);
            }
        }
    }
}

void TFT_rounddd(void *h2p_lw_addr,uint16_t x, uint16_t y, uint16_t rad, uint8_t COLOR)
{
    uint16_t x1=0;
    uint16_t y1=0;

    for(y1=0; y1<=2*rad; y1++)
    {


        for(x1=0; x1<=2*rad; x1++)
        {


            if ((x1-rad)*(x1-rad)+(y1-rad)*(y1-rad) <= (rad*rad))
            {
                TFT_setpix(h2p_lw_addr,x1+x,y1+y,COLOR);
            }
        }
    }
}

void TFT_line(void *h2p_lw_addr,uint16_t x1, uint16_t y1, uint16_t x2, uint16_t y2, uint8_t COLOR)
{

    int dx = abs(x2-x1), sx = x1<x2 ? 1 : -1;
    int dy = abs(y2-y1), sy = y1<y2 ? 1 : -1;
    int err = (dx>dy ? dx : -dy)/2, e2;

    for(;;)
    {
        TFT_setpix(h2p_lw_addr,x1,y1,COLOR);
        if (x1==x2 && y1==y2) break;
        e2 = err;
        if (e2 >-dx)
        {
            err -= dy;
            x1 += sx;
        }
        if (e2 < dy)
        {
            err += dx;
            y1 += sy;
        }
    }
}

void TFT_setpix(void *h2p_lw_addr,unsigned short X, unsigned short Y, uint8_t COLOR)
{
    *(uint8_t *)(h2p_lw_addr + getaddr(X,Y)) = COLOR;
}

int getaddr(unsigned short X, unsigned short Y)
{

    if (X<=Hsize && Y<=Vsize)
        return  ((Y * Hsize)+X);

    return -1;

}
